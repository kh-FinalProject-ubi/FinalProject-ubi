<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.kh.project.welfare.like.model.mapper.WelfareFacilityLikeMapper">

  <!-- 찜 상태 확인 (찜 여부: 'N', 'Y' or null) -->
  <select id="selectLikeStatus" resultType="string">
    SELECT jj_del_fl
    FROM welfare_facility
    WHERE member_no = #{memberNo}
      AND facility_name = #{facilityName}
      AND region_city = #{regionCity}
      AND region_district = #{regionDistrict}
    FETCH FIRST 1 ROWS ONLY
  </select>

  <!-- 찜 등록 -->
  <insert id="insertLike" parameterType="FacilityLike">
    INSERT INTO welfare_facility (
      facility_no,
      facility_api_service_id,
      member_no,
      facility_name,
      region_city,
      region_district,
      facility_addr,
      lat,
      lng,
      jj_time,
      jj_del_fl,
      alarm_sent_fl
    ) VALUES (
      welfare_facility_seq.NEXTVAL,
      #{facilityApiServiceId},
      #{memberNo},
      #{facilityName},
      #{regionCity},
      #{regionDistrict},
      #{facilityAddr},
      #{lat},
      #{lng},
      SYSDATE,
      'N',
      'N'
    )
  </insert>

  <!-- 찜 복구 (기존에 있던 행 활성화) -->
  <update id="reactivateLike" parameterType="FacilityLike">
    UPDATE welfare_facility
    SET jj_del_fl = 'N',
        jj_time = SYSDATE
    WHERE member_no = #{memberNo}
      AND facility_name = #{facilityName}
      AND region_city = #{regionCity}
      AND region_district = #{regionDistrict}
  </update>

  <!-- 찜 취소 -->
  <update id="deleteLike" parameterType="FacilityLike">
    UPDATE welfare_facility
    SET jj_del_fl = 'Y'
    WHERE member_no = #{memberNo}
      AND facility_name = #{facilityName}
      AND region_city = #{regionCity}
      AND region_district = #{regionDistrict}
  </update>

</mapper>