<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.kh.project.member.model.mapper.MemberMapper">
	
	<!-- 로그인  -->
<select id="login" resultType="Member" parameterType="string">
  SELECT
    MEMBER_NO,
    MEMBER_ID,
    MEMBER_NICKNAME,
    MEMBER_PW,
    MEMBER_TEL,
    MEMBER_ADDRESS,
    MEMBER_STANDARD, <!-- ✅ 추가 -->
    MEMBER_IMG,
    AUTHORITY,
    TO_CHAR(ENROLL_DATE, 'YYYY"년" MM"월" DD"일"') AS ENROLL_DATE
  FROM MEMBER
  WHERE MEMBER_ID = #{memberId}
    AND MEMBER_DEL_FL = 'N'
</select>

	<!-- 이메일 중복 검사 -->
	<select id="checkEmail" resultType="_int">
	SELECT COUNT(*)
	FROM "MEMBER"
	WHERE MEMBER_EMAIL = #{memberEmail}
	AND MEMBER_DEL_FL = 'N'
	</select>
	
	<!-- 닉네임 중복 검사 -->
	<select id="checkNickname">
	 SELECT COUNT(*)
	 FROM "MEMBER"
	 WHERE MEMBER_NICKNAME = #{memberNickname}
	 AND MEMBER_DEL_FL = 'N'
	</select>

<insert id="signup" parameterType="Member">
  <selectKey keyProperty="memberNo" resultType="int" order="BEFORE">
    SELECT SEQ_MEMBER_NO.NEXTVAL FROM DUAL
  </selectKey>

  INSERT INTO MEMBER (
    MEMBER_NO, MEMBER_ID, MEMBER_PW, MEMBER_NICKNAME,
    MEMBER_EMAIL, MEMBER_TEL, MEMBER_ADDRESS,
    MEMBER_TADDRESS, REGION_DISTRICT, REGION_CITY,
    MEMBER_NAME, AUTHORITY, MEMBER_STANDARD, KAKAO_ID, MEMBER_DEL_FL
  )
  VALUES (
    #{memberNo}, #{memberId}, #{memberPw}, #{memberNickname},
    #{memberEmail}, #{memberTel}, #{memberAddress},
    #{memberTaddress}, #{regionDistrict}, #{regionCity},
    #{memberName}, 1, #{memberStandard}, #{kakaoId}, 'N'
  )
</insert>

<!-- 아이디 중복 검사 -->
<select id="checkMemberId" resultType="int">
  SELECT COUNT(*)
  FROM MEMBER
  WHERE MEMBER_ID = #{memberId}
  AND MEMBER_DEL_FL = 'N'
</select>

<select id="selectByKakaoId" parameterType="string" resultType="Member">
  SELECT
    MEMBER_NO,
    MEMBER_ID,
    MEMBER_NICKNAME,
    MEMBER_PW,
    MEMBER_TEL,
    MEMBER_ADDRESS,
    MEMBER_STANDARD,
    MEMBER_IMG,
    KAKAO_ID, 
    AUTHORITY,
    TO_CHAR(ENROLL_DATE, 'YYYY"년" MM"월" DD"일"') AS ENROLL_DATE
  FROM MEMBER
  WHERE KAKAO_ID = #{kakaoId}
  AND MEMBER_DEL_FL = 'N'
</select>

<select id="selectByNo" resultType="Member">
    SELECT * FROM MEMBER WHERE MEMBER_NO = #{memberNo} AND MEMBER_DEL_FL = 'N'
</select>
</mapper>
